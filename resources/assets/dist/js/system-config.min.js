/* All right reserved by Neusoft Co. Ltd. 2016-10-14 11:10:54 */
!function(a){a.config={initConfig:function(a){var b={};b.url=appPath+"/utf/system/config/initConfig.action",b.sync=!1,b.load=a;var c=new DataCenter;$.maf.action.requestData(b,c)},updateConfig:function(a,b){var c={};c.url=appPath+"/utf/system/config/updateConfig.action",c.sync=!1,c.load=b,$.maf.action.requestData(c,a)}}}($.ude.rpc),function(a){function b(){a.ude.util.pageResize(),c()}function c(){var b=function(b){if(!b||"0"!==b.getCode())return void showMessage(b.getDetail(),null,"error");var c=b.getDataStore("configStore"),d=c.getRowSet().getRow(0).data;a("#targetHotSpotNode").val(d.targetHotSpotNode),a("#iosTargetHotSpotNode").val(d.iosTargetHotSpotNode),a("#processBarXpath").val(d.processBarXpath),a("#iosProcessBarXpath").val(d.iosProcessBarXpath);var f=new Array,g=d.systemCommand;if(g)for(var h=g.split(";"),i=0,j=h.length;i<j;i++){var k=h[i].split(":"),l={name:k[0],command:k[1]};f.push(l)}var m=new Array;m.push({columnName:"\u547d\u4ee4\u540d\u79f0",columnWidth:180,columnValueKey:"name"}),m.push({columnName:"\u547d\u4ee4",columnWidth:350,columnValueKey:"command"}),e(a("#systemCommand"),f,m),a("#iosSystemCommand").val(d.iosSystemCommand),a("#macHosts").val(d.macHosts);var n=new Array,o=d.paramOperatorActions;o&&(n=JSON.parse(o));var p=new Array;p.push({columnName:"\u64cd\u4f5c\u540d\u79f0",columnWidth:180,columnValueKey:"name"}),p.push({columnName:"\u64cd\u4f5c",columnWidth:350,columnValueKey:"operStr"}),e(a("#paramOperations"),n,p),a("#paramOperations").val(d.paramOperatorActions)};a.ude.rpc.config.initConfig(b),a("#saveConfig").click(function(){d()})}function d(){for(var b=a.trim(a("#targetHotSpotNode").val()),c=a.trim(a("#iosTargetHotSpotNode").val()),d=a.trim(a("#processBarXpath").val()),e=a.trim(a("#iosProcessBarXpath").val()),g=a.trim(a("#iosSystemCommand").val()),h=a.trim(a("#macHosts").val()),i=a("#systemCommand").handsontable("getData"),j=a("#paramOperations").handsontable("getData"),k="",l=0,m=i.length;l<m;l++){var n=i[l];if(n.name&&n.command){var o="";0!=l&&(o+=";"),o+=n.name+":"+n.command,k+=o}}var p=k,q="";if(j){for(var r=new Array,l=0,m=j.length;l<m;l++){var s=j[l];s.name&&s.operStr&&r.push(s)}q=JSON.stringify(r)}var t=function(a){return a&&"0"===a.getCode()?void showMessage("\u4fdd\u5b58\u6210\u529f",null,"info"):void showMessage(a.getDetail(),null,"error")},u={};u.id="utfProjectConfig",u.targetHotSpotNode=b,u.iosTargetHotSpotNode=c,u.processBarXpath=d,u.iosProcessBarXpath=e,u.systemCommand=p,u.iosSystemCommand=g,u.macHosts=h,u.paramOperatorActions=q;var v=new DataStore(f);v.setRowSetName(f),v.getRowSet().addRow(u);var w=new DataCenter;w.addDataStore(v),a.ude.rpc.config.updateConfig(w,t)}function e(a,b,c){for(var d=new Array,e=new Array,f=new Array,g=0,h=c.length;g<h;g++)d.push(c[g].columnName),e.push(c[g].columnWidth),f.push({data:c[g].columnValueKey});a.handsontable({data:b,minSpareRows:1,colHeaders:d,colWidths:e,manualColumnResize:!0,manualRowResize:!0,columnSorting:!0,rowHeaders:!0,height:250,contextMenu:{items:{row_above:{name:"\u5728\u6b64\u884c\u524d\u63d2\u5165\u4e00\u884c"},row_below:{name:"\u5728\u6b64\u884c\u540e\u63d2\u5165\u4e00\u884c"},remove_row:{name:"\u5220\u9664\u6b64\u884c"}}},columns:f})}var f="com.neusoft.utf.portal.system.project.entity.UtfProjectConfigT";a.ude.page.system.config.main={init:b}}(jQuery);