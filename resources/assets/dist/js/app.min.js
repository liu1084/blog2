/* All right reserved by Neusoft Co. Ltd. 2016-10-14 10:10:13 */
!function(a){function b(){a("#applicationTable").data("appStore",null)}function c(){return a("#applicationTable").data("appStore")}function d(b){a("#applicationTable").data("appStore",b),b.addRowData=function(a){b.getRowSet().addRow(a)},b.deleteRowData=function(a,c){c=c?c:"id";for(var d=b.getRowSet().getRowCount(),e=null,f=-1,g=0;g<d;g++)if(e=b.getRowSet().getRow(g),e.getItemValue(c)===a[c]){f=g;break}f<0||b.getRowSet().deleteRow(f)},b.updateRowData=function(a,c){c=c?c:"id";for(var d=b.getRowSet().getRowCount(),e=null,f=0;f<d&&(e=b.getRowSet().getRow(f),e.getItemValue(c)!==a[c]);f++);if(e)for(var g in a)e.setItemValue(g,a[g])}}a.ude.page.system.app={},a.ude.page.system.app.parameter={initParameters:b,getAppStore:c,setAppStore:d}}(jQuery),function(a){a.app={getAllAppInfo:function(a){var b={};b.url=appPath+"/utf/system/project/getApplicationInfo.action",b.sync=!1,b.load=a,$.maf.action.requestData(b)},addApp:function(a,b){var c={};c.fileElementId="upload",c.data=a,c.url=appPath+"/utf/system/project/addApplication.action",c.success=b,$.maf.action.uploadFile(c)},editApp:function(a,b){var c={};c.fileElementId="upload",c.data=a,c.url=appPath+"/utf/system/project/editApplication.action",c.success=b,$.maf.action.uploadFile(c)},deleteApp:function(a,b){var c=new DataCenter;c.addParameter("id",a);var d={};d.url=appPath+"/utf/system/project/deleteApplication.action",d.sync=!1,d.load=b,$.maf.action.requestData(d,c)},setCurrentVersion:function(a,b){var c=new DataCenter;c.addParameter("id",a);var d={};d.url=appPath+"/utf/system/project/setCurrentApplication.action",d.sync=!1,d.load=b,$.maf.action.requestData(d,c)},queryProjectByName:function(a,b){var c=new DataCenter;c.addParameter("pjName",b);var d={};d.url=appPath+"/utf/system/project/queryProjectByName.action",d.sync=!1,d.load=a,$.maf.action.requestData(d,c)},getCurrentPkg:function(a){var b=new DataCenter,c={};c.url=appPath+"/utf/system/project/getCurrentPkg.action",c.sync=!1,c.load=a,$.maf.action.requestData(c,b)}}}($.ude.rpc),function(a){function b(){c(),w(),a(".common-content-down").css("height",a(".common-content").height()-a(".common-content-top").outerHeight()),a.ude.rpc.app.getAllAppInfo(i)}function c(){a("#saveId").click(function(){d()&&e()}),a("#getCurrentPkg").click(function(){f()})}function d(){var b=a.trim(a("#appName").val()),c=a.trim(a("#upload").val()),d=a.trim(a("#appID").val());if(!b||""===b)return showMessage("\u8bf7\u8f93\u5165\u5e94\u7528\u540d\u79f0",a("#appDialog"),"error"),a("#appName").focus(),!1;if(c&&""!==c){if(""!==d)return showMessage("\u5df2\u4e0a\u4f20\u5e94\u7528\uff0c\u65e0\u9700\u586b\u5199\u5e94\u7528\u6807\u793a",a("#appDialog"),"error"),a("#upload").focus(),a("#appID").focus(),!1}else if(!d||""===d)return showMessage("\u6ca1\u6709\u4e0a\u4f20\u5e94\u7528\uff0c\u8bf7\u8f93\u5165\u5e94\u7528\u6807\u793a",a("#appDialog"),"error"),a("#upload").focus(),a("#appID").focus(),!1;return!0}function e(){var b=a.trim(a("#appName").val()),c=a.trim(a("#versionNum").val()),d=a.trim(a("#appID").val()),e=a.trim(a("#publishDate").val()),f={appName:b,versionNum:c,appID:d,publishDate:e};a("#appDialog").prop("add")?g(f):(f.id=x,h(f))}function f(){var b=function(b){if(b&&"0"==b.getCode()){var c=b.getParameter("pkg");a("#appID").val(c)}else{var d=b.getDetail();showMessage(d,a("#appDialog"),"error")}};a.ude.rpc.app.getCurrentPkg(b)}function g(b){var c=function(c){if(c&&"0"==c.getCode()){b.id=c.getParameter("id"),b.fileName=c.getParameter("fileName"),b.uploadDate=c.getParameter("uploadDate"),b.uploadUser=c.getParameter("uploadUser"),b.currentVersion="0",a("#applicationTable").udeTable().fnAddRow(b);var d=y.getAppStore();d.addRowData(b),a.ude.dialog.close()}else{var e=c.getDetail();showMessage(e,a("#appDialog"),"error")}};a.ude.rpc.app.addApp(b,c)}function h(b){var c=function(c){if(c&&"0"==c.getCode()){b.id=c.getParameter("id"),b.fileName=c.getParameter("fileName"),b.uploadDate=c.getParameter("uploadDate"),b.uploadUser=c.getParameter("uploadUser"),b.currentVersion=c.getParameter("currentVersion"),a("#applicationTable").udeTable().fnUpdateRow(b);var d=y.getAppStore();d.updateRowData(b),a.ude.dialog.close()}else{var e=c.getDetail();showMessage(e,a("#appDialog"),"error")}};a.ude.rpc.app.editApp(b,c)}function i(a){if(!a)return void showMessage("\u83b7\u53d6\u5e94\u7528\u6570\u636e\u5931\u8d25",null,"error");if("1"===a.getCode())return void showMessage(a.getDetail(),null,"error");if(a){var b=a.getDataStore("appStore");y.setAppStore(b),m(),v(b.getRowSet().getData())}}function j(){}function k(){var b=a("#applicationTable").udeTable().fnGetSelectedRowData();if(null==b)return void showMessage("\u8bf7\u9009\u62e9\u8981\u8bbe\u7f6e\u7684\u6570\u636e",null,"error");var c=b.currentVersion;return 1==c?void showMessage("\u60a8\u6240\u9009\u62e9\u7684\u5df2\u7ecf\u662f\u5f53\u524d\u6d4b\u8bd5\u7248\u672c",null,"error"):(x=b.id,void a.ude.rpc.app.setCurrentVersion(x,l))}function l(){a("#application").click()}function m(){a("#addApplicationBtn").bind("click",function(){p()}),a("#editApplicationBtn").bind("click",function(){q()}),a("#deleteApplicationBtn").bind("click",function(){r()}),a("#downloadApplicationBtn").bind("click",function(){j()}),a("#setCurrentVersionBtn").bind("click",function(){k()}),n()}function n(){var b={timeOnlyTitle:a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_timeOnlyTitle"),currentText:a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_currentText"),closeText:a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_closeText"),customFormat:"yy-mm-dd",showHour:!1,showMinute:!1,showTime:!1,changeMonth:!0,changeYear:!0,monthNamesShort:[a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort1"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort2"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort3"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort4"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort5"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort6"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort7"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort8"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort9"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort10"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort11"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort12")],dayNamesMin:[a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin0"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin1"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin2"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin3"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin4"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin5"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin6")]};a("#publishDate").datetimepicker(b)}function o(){a("#appName").val(""),a("#versionNum").val(""),a("#appID").val(""),a("#publishDate").val(""),a("#upload").val("")}function p(){o(),a("#appDialog").prop("add",!0),a.ude.dialog.open("appDialog",{title:"\u65b0\u589e\u5e94\u7528",width:"500px"})}function q(){var b=a("#applicationTable").udeTable().fnGetSelectedRowData();return null==b?void showMessage("\u8bf7\u9009\u62e9\u8981\u7f16\u8f91\u7684\u6570\u636e",null,"error"):(x=b.id,a("#appName").val(b.appName),a("#versionNum").val(b.versionNum),a("#appID").val(b.appID),a("#publishDate").val(b.publishDate),a("#appDialog").prop("add",!1),void a.ude.dialog.open("appDialog",{title:a.i18n.prop("\u7f16\u8f91\u5e94\u7528"),width:"500px"}))}function r(){var b=a("#applicationTable").udeTable().fnGetSelectedRowData();return z=b,b?void a.ude.util.confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",s):void showMessage("\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u5e94\u7528",null,"error")}function s(){var b=a("#applicationTable").udeTable().fnGetSelectedRowData();a.ude.rpc.app.deleteApp(b.id,t)}function t(b){if(b&&"0"===b.getCode()){a("#applicationTable").udeTable().fnDeleteRow();var c=y.getAppStore();c.deleteRowData(z)}else{var d=b.getDetail();showMessage(d,null,"error")}}function u(a,b){return a&&1==a?"\u662f":"\u5426"}function v(b){a("#applicationTable").udeTable({data:b,columns:[{sTitle:"\u5e94\u7528\u540d\u79f0",mData:"appName",sWidth:"15%"},{sTitle:"\u5e94\u7528\u6807\u793a",mData:"appID",sWidth:"15%"},{sTitle:"\u6d4b\u8bd5\u7248\u672c",mData:"currentVersion",sWidth:"10%",mRender:u},{sTitle:"\u7248\u672c\u53f7",mData:"versionNum",sWidth:"10%"},{sTitle:"\u53d1\u5e03\u65f6\u95f4",mData:"publishDate",sWidth:"15%"},{sTitle:"\u4e0a\u4f20\u65f6\u95f4",mData:"uploadDate",sWidth:"15%"},{sTitle:"\u4e0a\u4f20\u4eba",mData:"uploadUser",sWidth:"20%"}]})}function w(){a.ude.pageResizeHandler=function(){a(".common-content-down").css("height",a(".common-content").height()-a(".common-content-top").outerHeight())}}a.ude.page.system.app.main={init:b};var x=null,y=a.ude.page.system.app.parameter,z=null}(jQuery);