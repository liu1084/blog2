/* All right reserved by Neusoft Co. Ltd. 2016-10-14 10:10:55 */
!function(a){a.execute.mobileResult={getAllMobileResultInfo:function(a){var b={};b.url=appPath+"/utf/execute/getAllMobileResultInfo.action",b.sync=!1,b.load=a,$.maf.action.requestData(b)},getMobileResultDetail:function(a,b){var c=new DataCenter;c.addParameter("execId",a);var d={};d.url=appPath+"/utf/execute/getMobileResultDetail.action",d.sync=!1,d.load=b,$.maf.action.requestData(d,c)},getMobileResultDetailToReport:function(a,b,c){var d=new DataCenter;d.addParameter("execId",a),d.addParameter("withImage",c);var e={};e.url=appPath+"/utf/execute/getMobileResultDetailToReport.action",e.sync=!1,e.load=b,$.maf.action.requestData(e,d)},getMobileResultScreenshot:function(a,b){var c=new DataCenter;c.addParameter("detailId",a);var d={};d.url=appPath+"/utf/execute/getMobileResultScreenshot.action",d.sync=!1,d.load=b,$.maf.action.requestData(d,c)}}}($.ude.rpc),function(a){function b(){var b={timeOnlyTitle:a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_timeOnlyTitle"),currentText:a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_currentText"),closeText:a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_closeText"),customFormat:"yyyy-mm-dd",showHour:!1,showMinute:!1,showTime:!1,changeMonth:!0,changeYear:!0,monthNamesShort:[a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort1"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort2"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort3"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort4"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort5"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort6"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort7"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort8"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort9"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort10"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort11"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_monthNamesShort12")],dayNamesMin:[a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin0"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin1"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin2"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin3"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin4"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin5"),a.i18n.prop("ude.page.system.project.projectJs.setTimePicker_dayNamesMin6")]};a("#createDate").datetimepicker(b),a("#endFreateDate").datetimepicker(b)}function c(){var b=a.trim(a("#sceneName").val()),c=a.trim(a("#osType").val()),e=a.trim(a("#createPerson").val()),f=a.trim(a("#createDate").val()),g=a.trim(a("#endFreateDate").val()),h=a.trim(a("#caseName").val());return""!=f&&""!=g&&f>g?void showMessage("\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65f6\u95f4",null,"error"):void d(b,c,e,f,g,h)}function d(b,c,d,e,f,g){a("#mobileResultTable").dataTable().fnDestroy(),i(appPath+"/utf/execute/getAllMobileResultInfo.action",[{name:"sceneName",value:b},{name:"osType",value:c},{name:"createPerson",value:d},{name:"createDate",value:e},{name:"endFreateDate",value:f},{name:"caseName",value:g}])}function e(){a("#createDate").mousedown(function(){}),a("#endFreateDate").mousedown(function(){}),a("#searchBtn").bind("click",function(){c()}),a("#casePassCount").bind("click",function(){y()}),a("#eventPassCount").bind("click",function(){z()}),a("#downLoadReport").bind("click",function(){a.ude.util.confirmAdd("\u662f\u5426\u8981\u5c06\u56fe\u7247\u4e0b\u8f7d\u5230\u672c\u5730\uff1f",function(){a.ude.rpc.execute.mobileResult.getMobileResultDetailToReport(I,function(a){var b=a.getParameter("downLoadPath");window.location.href=appPath+b},"yes")},function(){a.ude.rpc.execute.mobileResult.getMobileResultDetailToReport(I,function(a){var b=a.getParameter("downLoadPath");window.location.href=appPath+b},"no")})}),b(),i(appPath+"/utf/execute/getAllMobileResultInfo.action",[]),C=!1,s(),a("#closeExecDialog").bind("click",function(b){a.ude.dialog.close()}),a("#memChartRadio").bind("click",function(){a("#memChart").show(),a("#cpuChart").hide()}),a("#cpuChartRadio").bind("click",function(){a("#memChart").hide(),a("#cpuChart").show()}),f(),a(".common-content-down").css("height",a(".common-content").height()-a(".common-content-top").outerHeight())}function f(){a("#showException").bind("click",function(b){a.ude.dialog.open("exceptionDialog",{title:"\u5f02\u5e38\u4fe1\u606f",width:"490px"})})}function g(b){if(!b)return void showMessage(a.i18n.prop("ude.page.execute.redrawExecResultSuccess"),null,"error");if(1===b.getCode())return void showMessage(b.getDetail(),null,"");var c=b.getDataStore("mobileResultStore"),d=c.getRowSet().getData(),e=d.length;return e>0?(H=d,A(B,H,"passingRates")):h("passingRatesChart","\u6ca1\u6709\u6570\u636e"),d}function h(b,c){var d=B.init(document.getElementById(b));d.dispose();var e=a("#"+b);e[0].innerHTML=c}function i(b,c){a("#mobileResultTable").pagingTable({oLanguage:{sEmptyTable:a.i18n.prop("ude.utfpagingtableJs.paging_nodata"),sInfo:a.i18n.prop("ude.utfpagingtableJs.paging_info"),sInfoEmpty:"",sZeroRecords:a.i18n.prop("ude.utfpagingtableJs.paging_nodata"),oPaginate:{sFirst:a.i18n.prop("ude.utfpagingtableJs.paging_first"),sLast:a.i18n.prop("ude.utfpagingtableJs.paging_last"),sNext:a.i18n.prop("ude.utfpagingtableJs.paging_next"),sPrevious:a.i18n.prop("ude.utfpagingtableJs.paging_previous")}},server:b,serverParams:c,serverCallback:g,bSort:!1,columns:[{sTitle:"\u573a\u666f\u540d",mData:"sceneName",sWidth:"10%"},{sTitle:"\u7528\u4f8b\u540d",mData:"caseName",sWidth:"28%"},{sTitle:"\u7528\u4f8b\u6570",mData:"caseCount",sWidth:"6%"},{sTitle:"\u7528\u4f8b\u901a\u8fc7\u7387",mData:"casePassingRates",sWidth:"6%",mRender:j},{sTitle:"\u6b65\u9aa4\u6570",mData:"eventsCount",sWidth:"6%"},{sTitle:"\u6b65\u9aa4\u901a\u8fc7\u7387",mData:"passingRates",sWidth:"6%",mRender:j},{sTitle:"\u64cd\u4f5c\u7cfb\u7edf",mData:"osType",sWidth:"8%"},{sTitle:"\u6267\u884c\u4eba",mData:"createPerson",sWidth:"10%"},{sTitle:"\u6267\u884c\u65f6\u95f4",mData:"createDate",sWidth:"15%",mRender:k},{sTitle:"\u8be6\u7ec6",mData:"id",sWidth:"5%",mRender:l}]})}function j(a){if(""!=a)return a+"%"}function k(b){return a.ude.util.dateFormat(b,"yyyy-MM-dd hh:mm:ss")}function l(a){return"<div style='text-align:center;'><div title ='\u67e5\u770b\u660e\u7ec6' class='report-query' onclick='$.ude.page.execute.mobileResult.showDetail(\""+a+"\")'></div></div>"}function m(b){I=b,a.ude.rpc.execute.mobileResult.getMobileResultDetail(b,n)}function n(b){if(!b)return void showMessage("\u83b7\u53d6\u8be6\u7ec6\u4fe1\u606f\u5931\u8d25\u3002",null,"error");if("1"===b.getCode())return void showMessage(b.getDetail(),null,"error");var c=b.getDataStore("stateStore"),d=b.getDataStore("eventStore"),e=b.getDataStore("infoStore");D=c.getRowSet().getData();var f=d.getRowSet().getData(),g=e.getRowSet().getData();document.getElementById("telInfos").innerHTML="",null!=g&&a("#telInfos").append("\u624b\u673a\u4fe1\u606f( "),null!=g[0].mobileInfoManufacturer&&a("#telInfos").append("\u5382\u5546\uff1a"+g[0].mobileInfoManufacturer+" | "),null!=g[0].mobileInfoModel&&a("#telInfos").append("\u578b\u53f7\uff1a"+g[0].mobileInfoModel+" | "),null!=g[0].mobileInfoVersion&&a("#telInfos").append("\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\uff1a"+g[0].mobileInfoVersion+" | "),null!=g[0].mobileInfoDensity&&a("#telInfos").append("\u5c4f\u5e55\u5206\u8fa8\u7387\uff1a"+g[0].mobileInfoDensity+" | "),null!=g[0].mobileInfoImsi&&a("#telInfos").append("imsi\uff1a"+g[0].mobileInfoImsi+" | "),null!=g&&a("#telInfos").append(" )"),G=new Array,F=new Array,E=null;for(var h=0;h<f.length;h++)E=b.getDataStore(f[h].operAction+h).getRowSet().getData(),G[h]=f[h].operAction,F[h]=E;document.getElementById("event_container").innerHTML="";var i=a("#event_container");i.css("overflow","auto");var j=document.body.clientHeight/(G.length+1);j<=200&&(j=200);for(var h=0;h<G.length;h++)i.append('<div class="common-content-top common-background"><div class="common-left "><label style="font-size:15px;float:left;">\u7528\u4f8b\u540d\u79f0:<span>'+G[h]+'</span></label></div><div class="common-right "><label style="font-size:15px;float:right;">\u603b\u6b65\u9aa4\u6570:<span id="totalCount'+h+'">0</span>,\u6210\u529f\u6570:<span id="successCount'+h+'">0</span>,\u5931\u8d25\u6570:<span id="failCount'+h+'">0</span></label></div></div><div class="common-content-down"><div class="system-content-down-middle"><div class="down-middle-content" style="height:'+j+'px"><table id="event_container'+h+'" class="udeTable" style="width:50%;"></table></div></div></div>');o()}function o(){p(),a.ude.dialog.open("executeProcess",{title:"\u7528\u4f8b\u6267\u884c\u7ed3\u679c",width:"1000px"}),a("#stateTable").udeTable().dataTable().fnClearTable(),a("#stateTable").udeTable().fnRedraw(D);for(var b=0;b<F.length;b++)if(E=F[b],a("#event_container"+b).udeTable().dataTable().fnClearTable(),a("#event_container"+b).udeTable().fnRedraw(E),a("#event_container"+b).udeTable().fnSelectRowByIndex(null),0==b){a("#event_container"+b).udeTable().fnSelectRowByIndex(E.length-1);var c=a("#event_container"+b).udeTable().fnGetSelectedRowData(),d=a("#event_container"+b).udeTable().data("onClick");d(c)}E=new Array;for(var e=0,b=0;b<F.length;b++)for(var f=0;f<F[b].length;f++)E[e]=F[b][f],e++;t(),a("#memChart").show(),a("#cpuChart").show(),v(B,E),x(B,E),a("#memChartRadio").click()}function p(){a("#state_container").css("height",a("#stateList").height()-8),a("#event_container").css("height",a("#execEventList").height()-a(".common-content-top").outerHeight()-8+document.body.clientHeight-280),C||(a("#stateTable").udeTable({data:null,bSort:!1,columns:[{sTitle:"\u72b6\u6001",mData:"resultState",sWidth:"20%",mRender:r},{sTitle:"\u4efb\u52a1\u540d\u79f0",mData:"objectText",sWidth:"80%"}]}),C=!0);for(var b=0;b<G.length;b++)a("#event_container"+b).udeTable({data:null,bSort:!1,columns:[{sTitle:"\u72b6\u6001",mData:"resultState",sWidth:"5%",mRender:r},{sTitle:a.i18n.prop("testcase.caseeditevent.initEventGrid.controlType"),mData:"objectType",sWidth:"10%"},{sTitle:"\u6587\u672c",mData:"objectText",sWidth:"18%"},{sTitle:"\u8def\u5f84",mData:"objectPath",sWidth:"10%"},{sTitle:"\u6807\u8bc6",mData:"objectId",sWidth:"10%"},{sTitle:a.i18n.prop("testcase.caseeditevent.initEventGrid.operActionId"),mData:"operAction",sWidth:"16%"},{sTitle:a.i18n.prop("testcase.caseeditevent.initEventGrid.varValue"),mData:"operValue",sWidth:"19%"},{sTitle:"\u4f4d\u7f6e",mData:"objectPosition",sWidth:"12%"}],onClick:q})}function q(b){var c=230,d=function(d){var e=d.getParameter("screenshot");if(e&&""!=e){var f=b.resultScreenshotHeight,g=b.resultScreenshotWidth,h=f*c/g;a("#eventResultAppImage").attr("src","data:image/png;base64,"+e),a("#eventResultAppImage").height(h),a("#eventResultAppImage").width(c)}else a("#eventResultAppImage").attr("src","")};a.ude.rpc.execute.mobileResult.getMobileResultScreenshot(b.id,d);var e=b.resultMsg,f=b.resultException;e&&""!=e?(a("#errorTable").show(),a("#errorMsg").val(e),a("#errorMsgContent").val(e),a("#exceptionMsg").val(f)):a("#errorTable").hide()}function r(b,c,d){var e="";e=b?"Running"==b?"running-state":"Finished"==b?"finished-state":"Error"==b?"error-state":"waiting-state":"waiting-state";var f=(d.id,a("<div class='cell-widget' align='center'/>")),g="<div class='testcasestate "+e+"'></div>",h=a(g);return f.append(h),a("<div/>").append(f).html()}function s(){a.ude.pageResizeHandler=function(){a(".common-content-down").css("height",a(".common-content").height()-a(".common-content-top").outerHeight())}}function t(){for(var b=0,c=0,d=1;d<=G.length;d++){b=d;for(var e=a("#event_container"+(d-1)).udeTable().fnGetData(),f=0,g=0,h=0;h<e.length;h++)"Finished"==e[h].resultState?f++:"Error"==e[h].resultState&&g++,"Finished"!=e[h].resultState&&(b=0);0==b&&c++,a("#totalCount"+(d-1)).text(e.length),a("#successCount"+(d-1)).text(f),a("#failCount"+(d-1)).text(g)}0==b&&(b=0),a("#caseCount").text(G.length),a("#caseSuccessCount").text(G.length-c),a("#failCaseCount").text(c),a("#casePassingRates").text(100-c/G.length*100+"%")}function u(a){B=a}function v(a,b){for(var c=a.init(document.getElementById("memChart")),d=[],e=[],f=0;f<b.length;f++)d[f]=f,b[f].resultMem?e[f]=parseInt(b[f].resultMem):e[f]=0;var g={tooltip:{trigger:"axis",formatter:function(a){var c=a[0][0],d=a[0][1],e=a[0][2],f="<div style='text-align:left;'>";return f=f+"\u63a7\u4ef6\u7c7b\u578b:"+b[d].objectType,f=f+"<br/>\u6587\u672c:"+b[d].objectText,f=f+"<br/>\u64cd\u4f5c:"+b[d].operAction,f=f+"<br/>"+c+":"+e+"MB",f+="</div>"}},grid:{x:40,y:10,x2:0,y2:10},calculable:!1,yAxis:[{type:"value",axisLabel:{formatter:"{value}M"}}],xAxis:[{type:"category",data:d,axisLabel:{show:!1}}],series:[{name:"\u5185\u5b58\u5360\u7528",type:"line",data:e}]};c.setOption(g),c.on("click",function(a){var b=a.name;w(b)})}function w(b){for(var c=0,d=-1,e=0;e<G.length;e++)a("#event_container"+e).udeTable().fnSelectRowByIndex(null);for(var e=0;e<G.length;e++){d+=Number(a("#totalCount"+e).text());{if(!(b>d)){b-=c,a("#event_container"+e).udeTable().fnSelectRowByIndex(b),a("#event_container"+e).udeTable().fnScrollToSelectedRow();var f=a("#event_container"+e).udeTable().fnGetSelectedRowData(),g=a("#event_container"+e).udeTable().data("onClick");g(f);break}c+=Number(a("#totalCount"+e).text())}}}function x(a,b){for(var c=a.init(document.getElementById("cpuChart")),d=[],e=[],f=0;f<b.length;f++)d[f]=f,b[f].resultCpu?e[f]=parseInt(b[f].resultCpu):e[f]=0;var g={tooltip:{trigger:"axis",formatter:function(a){var c=a[0][0],d=a[0][1],e=a[0][2],f="<div style='text-align:left;'>";return f=f+"\u63a7\u4ef6\u7c7b\u578b:"+b[d].objectType,f=f+"<br/>\u6587\u672c:"+b[d].objectText,f=f+"<br/>\u64cd\u4f5c:"+b[d].operAction,f=f+"<br/>"+c+":"+e+"%",f+="</div>"}},grid:{x:40,y:10,x2:0,y2:10},calculable:!1,yAxis:[{type:"value",axisLabel:{formatter:"{value}%"}}],xAxis:[{type:"category",data:d,axisLabel:{show:!1}}],series:[{name:"CPU\u5360\u7528",type:"line",data:e}]};c.setOption(g),c.on("click",function(a){var b=a.name;w(b)})}function y(){A(B,H,"casePassingRates"),a("#casePassCount").attr("checked",!0),a("#eventPassCount").attr("checked",!1)}function z(){A(B,H,"passingRates"),a("#eventPassCount").attr("checked",!0),a("#casePassCount").attr("checked",!1)}function A(b,c,d){var e=b.init(document.getElementById("passingRatesChart")),f=[],g=[];if("passingRates"==d)for(var h=0;h<c.length;h++)f[h]=h,c[h].passingRates?g[h]=parseInt(c[h].passingRates):g[h]=0;else if("casePassingRates"==d)for(var h=0;h<c.length;h++)f[h]=h,c[h].casePassingRates?g[h]=parseInt(c[h].casePassingRates):g[h]=0;var i={tooltip:{trigger:"axis",formatter:function(b){var d=b[0][0],e=b[0][1],f=b[0][2],g="<div style='text-align:left;'>";return g=g+"\u573a\u666f\u540d:"+c[e].sceneName,g=g+"<br/>\u6267\u884c\u65f6\u95f4:"+a.ude.util.dateFormat(c[e].createDate,"yyyy-MM-dd hh:mm:ss"),g=g+"<br/>"+d+":"+f+"%",g+="</div>"}},grid:{x:40,y:10,x2:0,y2:10},calculable:!1,yAxis:[{type:"value",axisLabel:{formatter:"{value}%"},splitNumber:5}],xAxis:[{type:"category",data:f,axisLabel:{show:!1}}],series:[{name:"\u901a\u8fc7\u7387",type:"line",data:g}]};e.setOption(i),e.on("click",function(b){var c=b.name;a("#mobileResultTable").udeTable().fnSelectRowByIndex(c),a("#mobileResultTable").udeTable().fnScrollToSelectedRow();var d=a("#mobileResultTable").udeTable().fnGetSelectedRowData(),e=a("#mobileResultTable").udeTable().data("onClick");e(d)})}a.ude.page.execute.mobileResult={init:e,initDashBoard:u,showDetail:m};var B,C=!1,D=null,E=null,F=null,G=null,H=null,I=""}(jQuery);