/* All right reserved by Neusoft Co. Ltd. 2016-10-14 10:10:00 */
!function(a){a.projectStructure={getQueryMenuTree:function(a,b){var c=new DataCenter;c.addParameter("ismenu",b);var d={};d.url=appPath+"/utf/config/projectstructure/queryMenuTree.action",d.sync=!1,d.load=a,$.maf.action.requestData(d,c)},getQueryMenuTreeNode:function(a,b,c,d){var e=new DataCenter;e.addParameter("id",b),e.addParameter("menuId",c),e.addParameter("pageType",d);var f={};f.url=appPath+"/utf/config/projectstructure/queryMenuTreeNode.action",f.sync=!1,f.load=a,$.maf.action.requestData(f,e)},saveMenuTreeData:function(a,b){var c={};c.url=appPath+"/utf/config/projectstructure/saveMenuTreeData.action",c.sync=!1,c.load=a,$.maf.action.requestData(c,b)},delTreeNode:function(a,b){var c=new DataCenter;c.addParameter("id",b);var d={};d.url=appPath+"/utf/config/projectstructure/delTreeNode.action",d.sync=!1,d.load=a,$.maf.action.requestData(d,c)},getTreeNodeDataByMenuId:function(a,b){var c=new DataCenter;c.addParameter("menuId",b);var d={};d.url=appPath+"/utf/config/projectstructure/getTreeNodeDataByMenuId.action",d.sync=!1,d.load=a,$.maf.action.requestData(d,c)}}}($.ude.rpc),function(a){function b(){a("#addMenuTreeBtn").click(H),a("#delMenuTreeBtn").click(J),a("#editMenuTreeBtn").click(L),a("#notMenuId").click(u),a("#menuId").click(v),a("#menuTreeSearchButton").click(i),a("#notMenuTreeSearchButton").click(j),a("#menuTreeSearch").click(g),a("#notMenuTreeSearch").click(h),a("#menuTreeSearch").bind("keyup",function(b){13===b.keyCode&&(a("#menuTreeSearchButton").click(),a("#menuTreeSearch").focus())}),a("#notMenuTreeSearch").bind("keyup",function(b){13===b.keyCode&&(a("#notMenuTreeSearchButton").click(),a("#notMenuTreeSearch").focus())}),B(),A(),T="menu",Y=null,Z=null,$=null,R="",a(".common-buttons-item").unbind("setDisableT"),a(".common-buttons-item").unbind("setDisableF"),a(".common-buttons-item").bind("setDisableT",function(b){var c=b.currentTarget.className;b.currentTarget.className=c.indexOf("-unavailable")<0?c+"-unavailable":c,a(b.currentTarget).attr("disabled","disabled")}),a(".common-buttons-item").bind("setDisableF",function(b){var c=b.currentTarget.className;b.currentTarget.className=c.replace("-unavailable",""),a(b.currentTarget).removeAttr("disabled")}),a("#addMenuTreeBtn").trigger("setDisableT"),a("#delMenuTreeBtn").trigger("setDisableT"),a("#editMenuTreeBtn").attr("disabled",!0)}function c(b){aa=b,"auto"===aa?(a("#menuTreeDiv").css({height:"250px"}),a("#notMenuTreeDiv").css({height:"250px"}),a("#notMenuTreeSearch").css({width:"86%"})):"case"===aa?(a("#menuTreeDiv").css({height:"86%"}),a("#notMenuTreeDiv").css({height:"86%"}),a("#notMenuTreeSearch").css({width:"78%"})):"page"===aa&&(a("#menuTreeDiv").css({height:"95%"}),a("#notMenuTreeDiv").css({height:"95%"}),a("#notMenuTreeSearch").css({width:"78%"})),a("#menuTreeSearch").css("width",a("#menuTreeSearch").parent().width()-40),a("#notMenuTreeSearch").css("width",a("#notMenuTreeSearch").parent().width()-40)}function d(a){_=a}function e(b){a.ude.rpc.projectStructure.getTreeNodeDataByMenuId(f,b),fa=b}function f(b){if(b&&b.getDataStore("UtfProjectAnalyseResult")){var c=b.getDataStore("UtfProjectAnalyseResult");if(c.getRowSet().getRowCount()>0){var d=c.getRowSet().getRow(0).data;T="1"===d.ismenu?"menu":"notMenu"}}"menu"===T?a("#menuId").click():a("#notMenuId").click()}function g(){ba=0,a("#menuTree").udeTree().searchTreeNodeByNameCss(R,!1),a("#menuTreeSearch").focus(),a("#menuTreeSearch").val("")}function h(){ba=0,a("#notMenuTree").udeTree().searchTreeNodeByNameCss(R,!1),a("#notMenuTreeSearch").focus(),a("#notMenuTreeSearch").val("")}function i(){R=a.trim(a("#menuTreeSearch").val()),""===R||null===R?showMessage(a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.searchMenuTreeNode_showMessage")+"\uff01",null,"info"):(a("#menuTree").udeTree().expandAll(),a("#menuTree").udeTree().searchTreeNodeByNameCss(R,!0),a("#menuTree").udeTree().searchTreeNodeByName(R,!0,ba),ba++)}function j(){R=a.trim(a("#notMenuTreeSearch").val()),""===R||null===R?showMessage(a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.searchNotMenuTreeNode_showMessage")+"\uff01",null,"info"):(a("#notMenuTree").udeTree().expandAll(),a("#notMenuTree").udeTree().searchTreeNodeByNameCss(R,!0),a("#notMenuTree").udeTree().searchTreeNodeByName(R,!0,ba),ba++)}function k(b){"editFlag"==a("#editFlag").html()?a("#menuTree").udeTree({data:b,key:{idKey:"menuId",parentIdKey:"parentMenuId"},edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1},callback:{onClick:E,onCheck:p,beforeDrag:l,beforeDrop:o},check:_}):a("#menuTree").udeTree({data:b,key:{idKey:"menuId",parentIdKey:"parentMenuId"},callback:{onClick:E,onCheck:p},check:_}),a("#menuTree").udeTree().selectNode("-1"),fa&&(a("#menuTree").udeTree().selectNode(fa),S=a("#menuTree").udeTree().getSelectedNode(),E(S.tId,S),fa=null)}function l(a,b){for(var c=0,d=b.length;c<d;c++)if(b[c].drag===!1)return!1;return!0}function m(){"notMenu"==T&&u(),"menu"==T&&v()}function n(b,c,d){if("inner"==d&&"-1"!=c.menuId){var e=function(){fa=null;var d={};d.id=b[0].id,d.menuId=b[0].menuId,d.parentMenuId=c.menuId;b[0].pageType;if(d.leaf="1",d.menuName=b[0].menuName,d.nodeUrl=b[0].nodeUrl,d.pageType=b[0].pageType,d.isEnabled=b[0].isEnabled,d.analyseKind=b[0].analyseKind,d.description=b[0].description,"menu"===T)d.ismenu="1";else{d.ismenu="2";a("#notMenuTree").udeTree().getSelectedNode()}var e="com.neusoft.utf.portal.config.projectstructure.entity.UtfProjectAnalyseResult",f=new DataCenter,g=new DataStore(e);g.setRowSetName(e),g.getRowSet().addRow(d),f.addDataStore(g),pageDC=f,a.ude.rpc.projectStructure.saveMenuTreeData(M,f)};a.ude.util.confirm(a.i18n.prop("ude.page.config.pageReDetect.pageReDetectJs.moveMenuTree_confirm")+"\uff1f",e,m)}else m()}function o(a,b,c,d){for(var e=0,f=b.length;e<f;e++)switch(b[e].parentTId){case"menuTree_1":m();break;case"menuTree":m();break;case"":m();break;case"menuTree_1":m();break;case"notMenuTree_1":m();break;case"notMenuTree":m();break;default:fa=b[0].menuId,n(b,c,d)}}function p(){$&&$()}function q(b){"editFlag"==a("#editFlag").html()?a("#notMenuTree").udeTree({data:b,key:{idKey:"menuId",parentIdKey:"parentMenuId"},edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1},callback:{onClick:F,onCheck:r,beforeDrag:l,beforeDrop:o},check:_}):a("#notMenuTree").udeTree({data:b,key:{idKey:"menuId",parentIdKey:"parentMenuId"},callback:{onClick:F,onCheck:r},check:_}),a("#notMenuTree").udeTree().selectNode("-1"),fa&&(ca=!0,a("#notMenuId").click(),a("#notMenuTree").udeTree().selectNode(fa),S=a("#notMenuTree").udeTree().getSelectedNode(),F(S.tId,S),fa=null)}function r(){$&&$()}function s(a){Y=a}function t(a){$=a}function u(){ca||(a("#notMenuTree").udeTree().destroy(),a("#menuTree").udeTree().destroy(),B()),T="notMenu",R="",a("#menuTreeSearch").val(""),a("#notMenuTreeSearch").val(""),Z&&Z(),ca=!1}function v(){a("#notMenuTree").udeTree().destroy(),a("#menuTree").udeTree().destroy(),A(),T="menu",R="",a("#menuTreeSearch").val(""),a("#notMenuTreeSearch").val(""),Z&&Z()}function w(){return S="menu"===T?a("#menuTree").udeTree().getSelectedNode():a("#notMenuTree").udeTree().getSelectedNode(),S.appimage=null,S.appdomxml=null,S}function x(){if("menu"===T){var b=a("#menuTree").udeTree().getSelectedNode(),c=b.name,d=b.level;if(k="",0===d)k=b.name;else if(d>2){for(var e=2;e<d;e++){var f=b.getParentNode(),g=f.name;k+=g+",",b=f}k=k.substring(0,k.length-1),k=k.split(",");for(var h=k.length,i="",j=h;j>0;j--)i+=k[j-1]+".";var k=i+c}else if(2===d)var k=c}else{var b=a("#notMenuTree").udeTree().getSelectedNode(),c=b.name,d=b.level;if(k="",0==d)k=b.name;else if(d>2){for(var e=2;e<d;e++){var f=b.getParentNode(),g=f.name;k+=g+",",b=f}k=k.substring(0,k.length-1),k=k.split(",");for(var h=k.length,i="",j=h;j>0;j--)i+=k[j-1]+".";var k=i+c}else if(2===d)var k=c}return k}function y(){var b=new DataCenter,c=new DataStore(ea);if(c.setRowSetName(ea),"menu"===T)var d=a("#menuTree").udeTree().getCheckedNode();else var d=a("#notMenuTree").udeTree().getCheckedNode();return c.getRowSet().addRows(d),b.addDataStore(c),b}function z(){_=!0,"menu"===T?(a("#menuTree").udeTree().destroy(),A()):(a("#notMenuTree").udeTree().destroy(),B())}function A(){var b="1";a.ude.rpc.projectStructure.getQueryMenuTree(C,b)}function B(){var b="2";a.ude.rpc.projectStructure.getQueryMenuTree(D,b)}function C(a){for(var b=a.getDataStore("menuTreeStore"),d=b.getRowSet().getRowCount(),e=0;e<d;e++){b.getRowSet().getRow(e).setItemValue("name",b.getRowSet().getRow(e).getItemValue("menuName"));var f=b.getRowSet().getRow(e).getItemValue("parentMenuId");"root"===f&&b.getRowSet().getRow(e).setItemValue("parentMenuId","-1")}var g=b.getRowSet().getData(),h=a.getParameter("pageType");h&&1==h&&(fa=a.getParameter("pageId")),k(g),c(aa)}function D(a){for(var b=a.getDataStore("menuTreeStore"),d=b.getRowSet().getRowCount(),e=0;e<d;e++){b.getRowSet().getRow(e).setItemValue("name",b.getRowSet().getRow(e).getItemValue("menuName"));var f=b.getRowSet().getRow(e).getItemValue("parentMenuId");"root"===f&&b.getRowSet().getRow(e).setItemValue("parentMenuId","-1")}var g=b.getRowSet().getData(),h=a.getParameter("pageType");h&&2==h&&(fa=a.getParameter("pageId")),q(g),c(aa)}function E(b,c){var d=c.pageType;"listMenu"===d||""===d||"undefined"==typeof d?(a("#nodetype").empty(),a("#nodetype").append('<option  value="listMenu" selected="selected">'+a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.treeMenuNodeClick_listMenu")+"</option>")):(a("#nodetype").empty(),a("#nodetype").append('<option  value="pageMenu" selected="selected">'+a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.treeMenuNodeClick_pageMenu")+"</option>"),a("#nodetype").append('<option  value="childPage">'+a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.treeMenuNodeClick_childPage")+"</option>")),U="update",O(),T="menu",da=1,V=c.id,W=c.menuId,X=c.parentMenuId,"-1"===W?(a("#addMenuTreeBtn").trigger("setDisableT"),a("#delMenuTreeBtn").trigger("setDisableT"),a("#editMenuTreeBtn").attr("disabled",!0)):"-1"===X?(a("#addMenuTreeBtn").trigger("setDisableF"),a("#delMenuTreeBtn").trigger("setDisableT"),a("#editMenuTreeBtn").attr("disabled",!0)):"childPage"!==d&&""!==d||"-1"==X?(a("#addMenuTreeBtn").trigger("setDisableF"),a("#delMenuTreeBtn").trigger("setDisableF"),a("#editMenuTreeBtn").attr("disabled",!1)):(a("#addMenuTreeBtn").trigger("setDisableF"),a("#delMenuTreeBtn").trigger("setDisableF"),a("#editMenuTreeBtn").attr("disabled",!1)),a.ude.rpc.projectStructure.getQueryMenuTreeNode(G,V,W,da),Y&&Y()}function F(b,c){var d=c.pageType;"listMenu"===d||""===d||"undefined"==typeof d?(a("#nodetype").empty(),a("#nodetype").append('<option  value="listMenu" selected="selected">'+a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.treeMenuNodeClick_listMenu")+"</option>")):(a("#nodetype").empty(),a("#nodetype").append('<option  value="pageMenu" selected="selected">'+a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.treeMenuNodeClick_pageMenu")+"</option>"),a("#nodetype").append('<option  value="childPage" >'+a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.treeMenuNodeClick_childPage")+"</option>")),U="update",O(),T="notMenu",V=c.id,W=c.menuId,X=c.parentMenuId,da=2,"-1"===W?(a("#addMenuTreeBtn").trigger("setDisableT"),a("#delMenuTreeBtn").trigger("setDisableT"),a("#editMenuTreeBtn").attr("disabled",!0)):"-1"===X?(a("#addMenuTreeBtn").trigger("setDisableF"),a("#delMenuTreeBtn").trigger("setDisableT"),a("#editMenuTreeBtn").attr("disabled",!0)):"childPage"!==d&&""!==d||"-1"==X?(a("#addMenuTreeBtn").trigger("setDisableF"),a("#delMenuTreeBtn").trigger("setDisableF"),a("#editMenuTreeBtn").attr("disabled",!1)):(a("#addMenuTreeBtn").trigger("setDisableF"),a("#delMenuTreeBtn").trigger("setDisableF"),a("#editMenuTreeBtn").attr("disabled",!1)),a.ude.rpc.projectStructure.getQueryMenuTreeNode(G,V,W,da),Y&&Y()}function G(b){var c=b.getDataStore("menuTreeNodeStore");a("#menuPageName").val(c.getRowSet().getRow(0).data.menuName),a("#menuPageUrl").val(c.getRowSet().getRow(0).data.nodeUrl),a("#nodetype").val(c.getRowSet().getRow(0).data.pageType),a("#isEnabled").val(c.getRowSet().getRow(0).data.isEnabled),a("#analyseKind").val(c.getRowSet().getRow(0).data.analyseKind),a("#desc").val(c.getRowSet().getRow(0).data.description)}function H(){var b;if(a("#addMenuTreeBtn")[0].className.indexOf("-unavailable")<0){b="menu"===T?a("#menuTree").udeTree().getSelectedNode():a("#notMenuTree").udeTree().getSelectedNode(),"-1"!=b.menuId&&a("#editMenuTreeBtn").attr("disabled",!1);b.pageType;a("#nodetype").empty(),a("#nodetype").append('<option  value="pageMenu" selected="selected">'+a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.addMenuTree_pageMenu")+"</option>"),a("#nodetype").append('<option  value="childPage">'+a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.addMenuTree_childPage")+"</option>"),U="add",N(),a("#menuPageName").val(""),a("#menuPageUrl").val(""),a("#nodetype").val(""),a("#desc").val(""),a("#menuPageName").focus()}}function I(){var b=a("#menuPageName").val();return!(!b||""===b)||(showMessage(a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.checkAvailability_menuPageName")+"\uff01",null,"error"),a("#menuPageName").focus(),!1)}function J(){a("#delMenuTreeBtn")[0].className.indexOf("-unavailable")<0&&a.ude.util.confirm(a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.delMenuTree_confirm")+"\uff1f",K)}function K(){if("menu"===T){var b=a("#menuTree").udeTree().getSelectedNode();a("#menuTree").udeTree().removeNode(b);var c=b.menuId;a.ude.rpc.projectStructure.delTreeNode(P,c)}else{var b=a("#notMenuTree").udeTree().getSelectedNode();a("#notMenuTree").udeTree().removeNode(b);var c=b.menuId;a.ude.rpc.projectStructure.delTreeNode(P,c)}}function L(){var b=I();if(b){var c={};if("add"==U){var d=(new Date).getTime();c.menuId=String(d),c.parentMenuId=W}else"update"===U&&(c.id=V,c.menuId=W,c.parentMenuId=X);a.trim(a("#nodetype").val());if(c.leaf="1",c.menuName=a("#menuPageName").val(),c.nodeUrl=a.trim(a("#menuPageUrl").val()),c.pageType=a.trim(a("#nodetype").val()),c.isEnabled=a.trim(a("#isEnabled").val()),c.analyseKind=a.trim(a("#analyseKind").val()),c.description=a.trim(a("#desc").val()),"menu"===T)c.ismenu="1";else{c.ismenu="2";a("#notMenuTree").udeTree().getSelectedNode()}var e="com.neusoft.utf.portal.config.projectstructure.entity.UtfProjectAnalyseResult",f=new DataCenter,g=new DataStore(e);g.setRowSetName(e),g.getRowSet().addRow(c),f.addDataStore(g),pageDC=f,a.ude.rpc.projectStructure.saveMenuTreeData(M,f)}}function M(b){if("menu"===T)var c=a("#menuTree").udeTree().getSelectedNode();else var c=a("#notMenuTree").udeTree().getSelectedNode();var d=b.getDataStore("utfProjectAnalyseResultList"),e=d.getRowSet().getRowCount();d.getRowSet().getRow(0).setItemValue("name",d.getRowSet().getRow(0).getItemValue("menuName"));var f=d.getRowSet().getRow(0).getData();return e>0&&("add"===U?"menu"===T?a("#menuTree").udeTree().addNode(c,f):a("#notMenuTree").udeTree().addNode(c,f):"update"===U&&("menu"===T?(c.name=d.getRowSet().getRow(0).getData().name,c.nodeUrl=d.getRowSet().getRow(0).getData().nodeUrl,c.pageType=d.getRowSet().getRow(0).getData().pageType,c.isEnabled=d.getRowSet().getRow(0).getData().isEnabled,c.analyseKind=d.getRowSet().getRow(0).getData().analyseKind,c.description=d.getRowSet().getRow(0).getData().description,a("#menuTree").udeTree().updateNode(c)):(c.name=d.getRowSet().getRow(0).getData().name,c.nodeUrl=d.getRowSet().getRow(0).getData().nodeUrl,c.pageType=d.getRowSet().getRow(0).getData().pageType,c.isEnabled=d.getRowSet().getRow(0).getData().isEnabled,c.analyseKind=d.getRowSet().getRow(0).getData().analyseKind,c.description=d.getRowSet().getRow(0).getData().description,a("#notMenuTree").udeTree().updateNode(c)))),U="update",b?void("0"===b.getCode()?(showMessage(a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.saveMenuTreeDataSuccess_success"),null,"info"),projectAnalyseDC=b):showMessage(b.getDetail(),null,"error")):void showMessage(a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.saveMenuTreeDataSuccess_fail"),null,"error")}function N(){a("#isEnabled").val("T"),a("#analyseKind").val("manual"),a("#isEnabled").attr("disabled",!0),a("#analyseKind").attr("disabled",!0)}function O(){a("#analyseKind").val("manual"),a("#isEnabled").attr("disabled",!1),a("#analyseKind").attr("disabled",!0)}function P(b){a("#menuPageName").val(""),a("#menuPageUrl").val(""),a("#nodetype").val(""),a("#desc").val(""),a("#isEnabled").val("T"),a("#menuTree").udeTree().selectNode("-1"),showMessage(a.i18n.prop("ude.page.config.projectStructure.projectStructureJs.delTreeNodeSuccess_showMessage"),null,"info")}function Q(a){Z=a}a.ude.page.config.projectStructure.main={init:b,addMenuTree:H,delMenuTree:J,editMenuTree:L,queryMenuTree:A,treeAttribution:w,treeNodeNamePath:x,udeTreeClick:s,udeTreeCheckClick:t,treeCheckNodeAttribution:y,initCheckTree:z,getIfCheckFlag:d,setAutoDetectHeight:c,caseClickSelectNode:e,udeTabClick:Q,openMenu:v};var R,S="",T="menu",U="",V="",W="",X="",Y=null,Z=null,$=null,_=!1,aa="this",ba=0,ca=!1,da=1,ea="com.neusoft.utf.portal.config.projectstructure.entity.UtfProjectAnalyseResult",fa=null}(jQuery);