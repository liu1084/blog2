/* All right reserved by Neusoft Co. Ltd. 2016-10-14 11:10:03 */
!function(a){a.user={initResources:function(a){var b={};b.url=appPath+"/utf/system/user/initUserPage.action",b.sync=!1,b.load=a,$.maf.action.requestData(b)},addUser:function(a,b){var c={};c.url=appPath+"/utf/system/user/addUser.action",c.sync=!1,c.load=b,$.maf.action.requestData(c,a)},editUser:function(a,b){var c={};c.url=appPath+"/utf/system/user/editUser.action",c.sync=!1,c.load=b,$.maf.action.requestData(c,a)},deleteUser:function(a,b){var c=new DataCenter;c.addParameter("id",a);var d={};d.url=appPath+"/utf/system/user/deleteUser.action",d.load=b,$.maf.action.requestData(d,c)},queryIdMatchedUserView:function(a,b){var c=new DataCenter;c.addParameter("id",b);var d={};d.url=appPath+"/utf/system/user/queryIdMatchedUserView.action",d.sync=!1,d.load=a,$.maf.action.requestData(d,c)},queryAccountMatchedUserViews:function(a,b){var c=new DataCenter;c.addParameter("account",b);var d={};d.url=appPath+"/utf/system/user/queryAccountMatchedUserViews.action",d.sync=!1,d.load=a,$.maf.action.requestData(d,c)},getAllUserViews:function(a){var b={};b.url=appPath+"/utf/system/user/getAllUserViews.action",b.sync=!1,b.load=a,$.maf.action.requestData(b)},getAllAuthorizeInfo:function(a,b){var c={};c.url=appPath+"/utf/system/user/getAllAuthorizeInfo.action",c.sync=!1,c.load=b,$.maf.action.requestData(c,a)},saveResourceAuthorities:function(a,b){var c={};c.url=appPath+"/utf/system/user/saveResourceAuthorities.action",c.sync=!1,c.load=b,$.maf.action.requestData(c,a)}}}($.ude.rpc),function(a){function b(){a("#userTypehead").data("searchKeyWord",null),a("#userTypehead").data("searchKey",null),a("#userTable").data("userStore",null)}function c(b){a("#userTable").data("userStore",b),b.addRowData=function(a){b.getRowSet().addRow(a)},b.deleteRowData=function(a,c){c=c?c:"id";for(var d=b.getRowSet().getRowCount(),e=null,f=-1,g=0;g<d;g++)if(e=b.getRowSet().getRow(g),e.getItemValue(c)===a[c]){f=g;break}f<0||b.getRowSet().deleteRow(f)},b.updateRowData=function(a,c){c=c?c:"id";for(var d=b.getRowSet().getRowCount(),e=null,f=0;f<d&&(e=b.getRowSet().getRow(f),e.getItemValue(c)!==a[c]);f++);if(e)for(var g in a)e.setItemValue(g,a[g])}}function d(){return a("#userTable").data("userStore")}function e(b){a("#userTypehead").data("searchKeyWord",b)}function f(){return a("#userTypehead").data("searchKeyWord")}function g(b){a("#userTypehead").data("searchKey",b)}function h(){return a("#userTypehead").data("searchKey")}a.ude.page.system.user.parameter={initParameters:b,setUserStore:c,getUserStore:d,setSearchKeyWord:e,setSearchKey:g,getSearchKeyWord:f,getSearchKey:h}}(jQuery),function(a){function b(){a.ude.util.pageResize(),G.initParameters(),a.ude.rpc.user.initResources(c),f(),y(),e(),a("#pw").bind("focus",function(){a("#userDialog").prop("add")||this.value!==I||(this.value="")}),a("#pw").bind("blur",function(){a("#userDialog").prop("add")||""!==this.value||(this.value=I)})}function c(b){if(!b)return void showMessage(a.i18n.prop("ude.page.system.user.userJs.initResourcesSuccess_showMessage"),null,"error");if("1"===b.getCode())return void showMessage(b.getDetail(),null,"error");var c=b.getDataStore("userStore");G.setUserStore(c),d(c),j(c.getRowSet().getData())}function d(b){a("#addUserBtn").bind("click",function(){p()}),a("#editUserBtn").bind("click",function(){q()}),a("#deleteUserBtn").bind("click",function(){u()}),g(b.getRowSet().getData())}function e(){a.ude.pageResizeHandler=function(){a.ude.util.pageResize(),a("#userTable").udeTable().fnResize()}}function f(){a("#account").prop("maxlength",20),a("#name").prop("maxlength",20),a("#description").prop("maxlength",200),a("#saveId").click(function(){x()&&r()})}function g(b){a("#userTable").udeTable({data:b,columns:[{sTitle:a.i18n.prop("ude.page.system.user.userJs.initTable_account"),mData:"account",sWidth:"20%"},{sTitle:a.i18n.prop("ude.page.system.user.userJs.initTable_name"),mData:"name",sWidth:"20%"},{sTitle:a.i18n.prop("ude.page.system.user.userJs.initTable_description"),mData:"description",sWidth:"60%"}],dblClick:function(){q()}})}function h(){G.setSearchKey(null)}function i(){a("#account").val(""),a("#pw").val(""),a("#name").val(""),a("#description").val("")}function j(b){var c=new Array;if(b)for(var d=null,e=b.length,f=null,g=0;g<e;g++)d=b[g],f=k(d.id,d.account),c.push(f);var h={source:function(){this.process(c)},property:"manufacturer",updater:function(a){var b=JSON.parse(a);return G.setSearchKeyWord(b.manufacturer),G.setSearchKey(b.manufacturer_id),l(),b.manufacturer},items:20};a("#userTypehead").typeahead(h)}function k(a,b){var c={manufacturer_id:a,manufacturer:b,toString:function(){return JSON.stringify(this)},toLowerCase:function(){return this.manufacturer.toLowerCase()},indexOf:function(a){return String.prototype.indexOf.apply(this.manufacturer,arguments)},replace:function(a){return String.prototype.replace.apply(this.manufacturer,arguments)}};return c}function l(){var b=G.getSearchKey();if(null!=b)a.ude.rpc.user.queryIdMatchedUserView(m,b);else{var c=a("#userTypehead").val();null==c||""===c?a.ude.rpc.user.getAllUserViews(m):a.ude.rpc.user.queryAccountMatchedUserViews(m,c)}}function m(b){if(!b)return void showMessage(a.i18n.prop("ude.page.system.user.userJs.matchingForAll_showMessage"),null,"error");if("1"===b.getCode())return void showMessage(b.getDetail(),null,"error");var c=b.getDataStore("users");return null==c?void showMessage(a.i18n.prop("ude.page.system.user.userJs.matchingForAll_queryMessage"),"error"):void a("#userTable").udeTable().fnRedraw(c.getRowSet().getData())}function n(b){var c=a("#userTypehead").typeahead(),d=c.data("typeahead"),e=o(b.getRowSet().getData());d.source=e}function o(a){var b=new Array;if(a)for(var c=null,d=a.length,e=null,f=0;f<d;f++)c=a[f],e=k(c.id,c.account),b.push(e);return b}function p(){i(),a("#userDialog").prop("add",!0),a.ude.dialog.open("userDialog",{title:a.i18n.prop("ude.page.system.user.userJs.newUser_userDialog"),width:"500px"})}function q(){var b=a("#userTable").udeTable().fnGetSelectedRowData();return null==b?void showMessage(a.i18n.prop("ude.page.system.user.userJs.editUser_showMessage"),null,"error"):(H=b.id,a("#account").val(b.account),a("#pw").val(I),a("#name").val(b.name),a("#description").val(b.description),a("#userDialog").prop("add",!1),void a.ude.dialog.open("userDialog",{title:a.i18n.prop("ude.page.system.user.userJs.editUser_userDialog"),width:"500px"}))}function r(){var b={};b.account=a.trim(a("#account").val()),b.password=a.trim(a("#pw").val()),b.name=a.trim(a("#name").val()),b.description=a.trim(a("#description").val());var c=new DataCenter,d=new DataStore(F);d.setRowSetName(F),d.getRowSet().addRow(b),c.addDataStore(d),a("#userDialog").prop("add")?s(c):(b.id=H,t(c))}function s(b){var c=b.getSingleDataStore(),d=c.getRowSet().getRow(0).data,e=function(b){if(b&&"0"===b.getCode()){var c=b.getSingleDataStore();d.id=c.getRowSet().getRow(0).data.id,a("#userTable").udeTable().fnAddRow(d);var e=G.getUserStore();e.addRowData(d),n(e),a.ude.dialog.close()}else{var f=b.getDetail();showMessage(f,a("#userDialog"),"error")}};a.ude.rpc.user.addUser(b,e)}function t(b){var c=b.getSingleDataStore(),d=c.getRowSet().getRow(0).data,e=function(b){if(b&&"0"===b.getCode()){a("#userTable").udeTable().fnUpdateRow(d);var c=G.getUserStore();c.updateRowData(d),n(c);var e=b.getParameter("newNameForCurrentUser");e&&a(".currentuser").text(e),a.ude.dialog.close()}else{var f=b.getDetail();showMessage(f,a("#userDialog"),"error")}};d.password===I&&(d.password=""),a.ude.rpc.user.editUser(b,e)}function u(){var b=a("#userTable").udeTable().fnGetSelectedRowData();return b?void a.ude.util.confirm(a.i18n.prop("ude.page.system.user.userJs.deleteUser_confirm")+"\uff1f",v):void showMessage(a.i18n.prop("ude.page.system.user.userJs.deleteUser_showMessage"),null,"error")}function v(){var b=a("#userTable").udeTable().fnGetSelectedRowData();a.ude.rpc.user.deleteUser(b.id,w)}function w(b){if(b&&"0"===b.getCode()){a("#userTable").udeTable().fnDeleteRow();var c=(a("#userTable").udeTable().fnGetSelectedRowData(),G.getUserStore());n(c)}else{var d=b.getDetail();showMessage(d,null,"error")}}function x(){var b=a.trim(a("#account").val()),c=a.trim(a("#pw").val()),d=a.trim(a("#name").val());return b&&""!==b?c&&""!==c?!(!d||""===d)||(showMessage(a.i18n.prop("ude.page.system.user.userJs.checkAvailability_name"),a("#userDialog"),"error"),a("#name").focus(),!1):(showMessage(a.i18n.prop("ude.page.system.user.userJs.checkAvailability_password"),a("#userDialog"),"error"),a("#pw").focus(),!1):(showMessage(a.i18n.prop("ude.page.system.user.userJs.checkAvailability_account"),a("#userDialog"),"error"),a("#account").focus(),!1)}function y(){z(),A()}function z(){a("#authorizePickList").pickList({height:"380px",width:"500px",label:"title",value:"id",sort:["orderNum","asc"],render:function(b){if(null==b.parentId){var c=a("<div class='authorize-edit-container' />").append("<div class='authorize-display parentMenu'>"+b.title+"</div>");return a("<div/>").append(c).html()}var c=a("<div class='authorize-edit-container' />").append("<div class='authorize-display childrenMenu'>"+b.title+"</div>");return a("<div/>").append(c).html()}})}function A(){a("#userAuthorizeBtn").click(function(){B()}),a("#authorizeSaveBtn").click(function(){D()})}function B(){var b=a("#userTable").udeTable().fnGetSelectedRowData();if(null==b)return void showMessage(a.i18n.prop("ude.page.system.user.userJs.showAuthorizeDialog_showMessage"),null,"error");var c=b.account;if("admin"===c)return void showMessage(a.i18n.prop("ude.page.system.user.userJs.showAuthorizeDialog_admin"),null,"error");a.ude.dialog.open("authorizeDialog",{title:a.i18n.prop("ude.page.system.user.userJs.showAuthorizeDialog_authorizeDialog"),width:"525px"});var d=new DataCenter;d.addParameter("account",c),a.ude.rpc.user.getAllAuthorizeInfo(d,C)}function C(b){if(0!=b.getCode())return void showMessage(b.getDetail(),null,"error");for(var c=b.getDataStore("curLogUserMenuListDs"),d=b.getDataStore("authorizedUserMenuListDs"),e=c.getRowSet().getData(),f=d.getRowSet().getData(),g=e.length,h=null,i=null,j={},k=0;k<g;k++)h=e[k].id,j[h]=e[k],i=e[k].parentId,null===i?J[h]=!0:delete J[i];for(var l=null,m=0;m<f.length;m++)l=j[f[m].id],null!=l&&(l.selected=!0);a("#authorizePickList").pickList("redraw",e)}function D(){var b=a("#authorizePickList").pickList("getSelectedRows");if(!b||0===b.length)return showMessage(a.i18n.prop("ude.page.system.user.userJs.saveAuthorizeList_showMessage"),a("#authorizeDialog"),"error"),!1;for(var c={id:null,title:null,selectedCount:-1},d=new Array,e=b.length,f=null,g=0;g<e;g++)if(f=b[g],d.push(f.id),!J[f.id])if(null===f.parentId){if(0===c.selectedCount)return void showMessage("\u3010"+c.title+"\u3011"+a.i18n.prop("ude.page.system.user.userJs.saveAuthorizeList_selectedRow"),a("#authorizeDialog"),"error");c.selectedCount=0,c.id=f.id,c.title=f.title}else{if(f.parentId!=c.id)return void showMessage("\u3010"+f.title+"\u3011"+a.i18n.prop("ude.page.system.user.userJs.saveAuthorizeList_rootMenuMap"),a("#authorizeDialog"),"error");c.selectedCount++}if(0===c.selectedCount)return void showMessage("\u3010"+c.title+"\u3011"+a.i18n.prop("ude.page.system.user.userJs.saveAuthorizeList_selectedCount")+"\u3002",a("#authorizeDialog"),"error");var h=new DataCenter,i=a("#userTable").udeTable().fnGetSelectedRowData().account;h.addParameter("account",i),h.addParameter("resourceIds",d.join(";")),a.ude.rpc.user.saveResourceAuthorities(h,E)}function E(b){if(b&&"0"===b.getCode())showMessage(a.i18n.prop("ude.page.system.user.userJs.saveResourceAuthoritiesComplete_showMessage")+"\u3002",null,"info"),a.ude.dialog.close();else{var c=b.getDetail();showMessage(c,null,"error")}}a.ude.page.system.user.main={init:b,clearKeyWord:h,searchUserByKey:l};var F="com.neusoft.unieap.techcomp.org.entity.User",G=a.ude.page.system.user.parameter,H=null,I="********",J={}}(jQuery);